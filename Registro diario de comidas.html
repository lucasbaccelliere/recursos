<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>REGISTRO DE COMIDAS DIARIAS</title>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
      color: #222;
    }
    h1, h2 {
      margin-top: 0;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      padding: 20px 24px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .row {
      margin-bottom: 12px;
    }
    label {
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
    }
    input[type="text"],
    input[type="date"],
    textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 6px 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-size: 14px;
      font-family: inherit;
    }
    textarea {
      min-height: 50px;
      resize: vertical;
    }
    .buttons {
      margin-top: 16px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    button {
      padding: 8px 16px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
    }
    button.primary {
      background: #1976d2;
      color: #fff;
    }
    button.secondary {
      background: #e0e0e0;
      color: #222;
    }
    button.danger {
      background: #c62828;
      color: #fff;
    }
    .flex {
      display: flex;
      gap: 24px;
      margin-top: 24px;
      flex-wrap: wrap;
    }
    .panel {
      flex: 1 1 280px;
      background: #fafafa;
      border-radius: 6px;
      padding: 12px 14px;
      border: 1px solid #ddd;
      max-height: 400px;
      overflow-y: auto;
    }
    .day-item {
      padding: 6px 8px;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid transparent;
      margin-bottom: 4px;
    }
    .day-item:hover {
      background: #e3f2fd;
      border-color: #90caf9;
    }
    .day-item.selected {
      background: #bbdefb;
      border-color: #1976d2;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 13px;
      background: #fff;
      border-radius: 4px;
      border: 1px solid #ddd;
      padding: 8px 10px;
    }
    .status {
      margin-top: 8px;
      font-size: 13px;
      color: #388e3c;
    }

    /* NUEVOS ESTILOS PARA CAMPOS DE ALIMENTO + CANTIDAD */
    .section {
      margin-top: 20px;
      padding: 12px;
      background: #fafafa;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    .section h3 {
      margin-top: 0;
    }
    .food-row {
      display: flex;
      gap: 10px;
      margin-bottom: 6px;
    }
    .food-row input {
      flex: 1;
    }
  </style>

  <script>
    /* Genera 5 filas de alimento + cantidad */
    function generarCamposComida(idBase) {
      let html = "";
      for (let i = 1; i <= 5; i++) {
        html += `
          <div class="food-row">
            <input type="text" id="${idBase}_alimento_${i}" placeholder="Alimento ${i}">
            <input type="text" id="${idBase}_cantidad_${i}" placeholder="Cantidad ${i}">
          </div>
        `;
      }
      return html;
    }
  </script>

</head>
<body>
  <div class="container">
    <h1>REGISTRO DE COMIDAS DIARIAS</h1>
    <p>Registrá tus comidas del día y consultá resúmenes cuando quieras.</p>

    <!-- Fecha -->
    <div class="row">
      <label for="fecha">Fecha</label>
      <input type="date" id="fecha">
    </div>

    <!-- Secciones de comidas -->
    <div class="section">
      <h3>Desayuno</h3>
      <div id="desayuno_campos"></div>
    </div>

    <div class="section">
      <h3>Media mañana</h3>
      <div id="media_manana_campos"></div>
    </div>

    <div class="section">
      <h3>Almuerzo</h3>
      <div id="almuerzo_campos"></div>
    </div>

    <div class="section">
      <h3>Media tarde</h3>
      <div id="media_tarde_campos"></div>
    </div>

    <div class="section">
      <h3>Merienda</h3>
      <div id="merienda_campos"></div>
    </div>

    <div class="section">
      <h3>Cena</h3>
      <div id="cena_campos"></div>
    </div>

    <!-- Botones -->
    <div class="buttons">
      <button class="primary" id="btnGuardar">Listo (guardar día)</button>
      <button class="secondary" id="btnLimpiar">Limpiar formulario</button>
      <button class="danger" id="btnBorrarTodo">Borrar todos los registros</button>
    </div>
    <div class="status" id="status"></div>

    <!-- Historial -->
    <div class="flex">
      <div class="panel">
        <h2>Días guardados</h2>
        <div id="listaDias"></div>
      </div>
      <div class="panel">
        <h2>Resumen del día seleccionado</h2>
        <pre id="resumen"></pre>
 	<button class="secondary" id="btnCopiarResumen">Copiar resumen</button>	
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "registro_comidas_diarias";

    function cargarDatos() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return {};
      try {
        return JSON.parse(raw);
      } catch (e) {
        console.error("Error al parsear datos:", e);
        return {};
      }
    }

    function guardarDatos(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function formatearFechaISO(fechaISO) {
      if (!fechaISO) return "";
      const [year, month, day] = fechaISO.split("-");
      return `${day}/${month}/${year}`;
    }

    /* Obtiene los 5 alimentos de cada comida */
    function obtenerComida(idBase) {
      const items = [];
      for (let i = 1; i <= 5; i++) {
        const alimento = document.getElementById(`${idBase}_alimento_${i}`).value.trim();
        const cantidad = document.getElementById(`${idBase}_cantidad_${i}`).value.trim();
        if (alimento || cantidad) {
          items.push({ alimento, cantidad });
        }
      }
      return items;
    }

    /* Construye el resumen */
    function construirResumen(fechaISO, dia) {
      const fechaFormateada = formatearFechaISO(fechaISO);

      function listar(items) {
        if (!items || items.length === 0) return "-";
        return items.map(i => `- ${i.alimento}, ${i.cantidad}`).join("\n");
      }

      return (
`Fecha: ${fechaFormateada}

Desayuno:
${listar(dia.desayuno)}

Media mañana:
${listar(dia.media_manana)}

Almuerzo:
${listar(dia.almuerzo)}

Media tarde:
${listar(dia.media_tarde)}

Merienda:
${listar(dia.merienda)}

Cena:
${listar(dia.cena)}`
      );
    }

    function refrescarListaDias() {
      const data = cargarDatos();
      const lista = document.getElementById("listaDias");
      lista.innerHTML = "";

      const fechas = Object.keys(data).sort().reverse();

      if (fechas.length === 0) {
        lista.textContent = "No hay días guardados todavía.";
        document.getElementById("resumen").textContent = "";
        return;
      }

      fechas.forEach(fechaISO => {
        const div = document.createElement("div");
        div.className = "day-item";
        div.textContent = formatearFechaISO(fechaISO);
        div.dataset.fecha = fechaISO;
        div.addEventListener("click", () => {
          document.querySelectorAll(".day-item").forEach(el => el.classList.remove("selected"));
          div.classList.add("selected");
          const dia = data[fechaISO];
          const resumen = construirResumen(fechaISO, dia);
          document.getElementById("resumen").textContent = resumen;
        });
        lista.appendChild(div);
      });
    }

    function limpiarFormulario() {
      document.querySelectorAll("input[type='text']").forEach(i => i.value = "");
    }

    document.getElementById("btnGuardar").addEventListener("click", () => {
      const fecha = document.getElementById("fecha").value;
      if (!fecha) {
        document.getElementById("status").textContent = "Por favor, seleccioná una fecha antes de guardar.";
        return;
      }

      const dia = {
        desayuno: obtenerComida("desayuno"),
        media_manana: obtenerComida("media_manana"),
        almuerzo: obtenerComida("almuerzo"),
        media_tarde: obtenerComida("media_tarde"),
        merienda: obtenerComida("merienda"),
        cena: obtenerComida("cena")
      };

      const data = cargarDatos();
      data[fecha] = dia;
      guardarDatos(data);

      document.getElementById("status").textContent = "Día guardado correctamente.";
      refrescarListaDias();
    });

    document.getElementById("btnLimpiar").addEventListener("click", () => {
      limpiarFormulario();
      document.getElementById("status").textContent = "Formulario limpiado.";
    });

    document.getElementById("btnBorrarTodo").addEventListener("click", () => {
      if (confirm("¿Seguro que querés borrar todos los registros?")) {
        localStorage.removeItem(STORAGE_KEY);
        document.getElementById("status").textContent = "Todos los registros fueron borrados.";
        refrescarListaDias();
      }
    });

    document.getElementById("btnCopiarResumen").addEventListener("click", () => {
      const texto = document.getElementById("resumen").textContent.trim();

      if (!texto) {
        document.getElementById("status").textContent = "No hay resumen para copiar.";
        return;
      }

      navigator.clipboard.writeText(texto)
        .then(() => {
          document.getElementById("status").textContent = "Resumen copiado al portapapeles.";
        })
        .catch(() => {
          document.getElementById("status").textContent = "No se pudo copiar el resumen.";
        });
    });

    window.addEventListener("load", () => {
      const hoy = new Date().toISOString().slice(0, 10);
      document.getElementById("fecha").value = hoy;

      document.getElementById("desayuno_campos").innerHTML = generarCamposComida("desayuno");
      document.getElementById("media_manana_campos").innerHTML = generarCamposComida("media_manana");
      document.getElementById("almuerzo_campos").innerHTML = generarCamposComida("almuerzo");
      document.getElementById("media_tarde_campos").innerHTML = generarCamposComida("media_tarde");
      document.getElementById("merienda_campos").innerHTML = generarCamposComida("merienda");
      document.getElementById("cena_campos").innerHTML = generarCamposComida("cena");

      refrescarListaDias();
    });
  </script>

</body>
</html>